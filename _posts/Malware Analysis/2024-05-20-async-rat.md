---
title: "Malware Analysis - AsyncRat"
classes: wide
header:
  teaser: /assets/images/MalwareAnalysis_AgentTesla_01/AgentTeslaPic_01.jpg
ribbon: pink
description: "AsyncRAT"
categories:
  - Malware Analysis
tags:
  - Trojan
  - Bot
  - Rat
  - CyberChef
toc: true
---
Sample:
```
a8d941db4a8f2301c661abff9d0121fa
```

# Background
AsyncRAT is a Remote Access Tool (RAT) designed to remotely monitor and control other computers through a secure, encrypted connection.
It can be delivered via various methods such as spear-phishing, malvertising, exploit kits, and other techniques.

# Static Analysis
<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/MalwareBazaar Sample.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 1: Malware Bazaar Entry</sub>
</div>
<br>

This sample was uploaded to Malware Bazaar, impersonating a leaked passwords text file. 
However, it was actually an LNK file that contained a suspicious command. 
Opening its properties revealed a command to download a new stage of the malware.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/properties of the lnk file.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 2: Properties of the LNK file</sub>
</div>
<br>

A decision was made to download the second stage without executing the file, so 'curl' was used.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/Downloading the vbs using curl.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 3: Curl to get the new stage</sub>
</div>
<br>

# Second Stage

After downloading and observing the second stage, it was found to be a large, obfuscated VBS file as shown in Figure 4.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/very big obfuscated vbs file.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 4: Obfuscated 2nd Stage</sub>
</div>
<br>

At the end of the file, it was observed that a simple replacement with null was used to decode the file as shown in Figure 5.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/At the end of the file we see a replace with nothing.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 5: Replacement code</sub>
</div>
<br>

Ctrl+H in Notepad++ can be used for this replacement. 
After replacing, a relatively clear code was revealed, as shown in Figure 6.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/AFter the replacement we can see normal code.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 6: After the replacement clear code was reaveled</sub>
</div>
<br>

After analyzing the code, it became clear that it was constructing four strings, combining them, and executing the result. 
To prevent accidental execution, a PowerShell script was written in a separate file, combining the strings into a single string as shown in Figure 7.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/simple PS script to extract those vars to one.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 7: PS Script to combine them all</sub>
</div>
<br>

Next, CyberChef was used to decode what appeared to be a reverse base64-encoded string, as shown in Figure 8.

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/managed to decode using reverse and base64.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 8: CyberChef to decode the string</sub>
</div>
<br>

Then, Strings was used in order to extract and gather critical information.

```batch
strings download.bin | findstr "http"
```

<div style="text-align: center;">
    <img src="/assets/images/2024-05-20-MalwareAnalysis_AsyncRAT/used strings to find more IOC , found another file dropped probably.PNG" alt="Screenshot1" />
    <br>
    <sub>Figure 9: Using Strings</sub>
</div>
<br>

































